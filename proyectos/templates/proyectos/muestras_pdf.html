{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Cargo de Recepción N° {{ recepcion.id }}</title>
    <style>
        @page {
            size: A4;
            /* REDUCIMOS EL MARGEN SUPERIOR DE 5CM A 3.8CM PARA QUE EMPIECE MÁS ARRIBA */
            margin: 3.8cm 1.5cm 2.5cm 1.5cm; 

            @frame header_frame {
                -pdf-frame-content: header_content;
                top: 0.5cm; /* SUBIMOS EL FRAME DE LA CABECERA CASI AL BORDE */
                left: 1.5cm;
                width: 18cm;
                height: 3.5cm;
            }

            @frame footer_frame {
                -pdf-frame-content: footer_content;
                bottom: 0.8cm;
                left: 1.5cm;
                width: 18cm;
                height: 1.5cm;
            }
        }
        
        #header_content table { border: none; margin-bottom: 0; }
        #header_content td { border: none; vertical-align: middle; }
        
        body { font-family: Helvetica, Arial, sans-serif; font-size: 9px; color: #000; line-height: 1.3; }
        .font-bold { font-weight: bold; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .corporate-blue { color: #004D99; }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 8px; }
        td, th { vertical-align: top; }
        
        #header_content { font-size: 8px; text-align: right; color: #000; }
        #footer_content { font-size: 8px; text-align: center; color: #000; }
        
        .logo-img { width: 160px; height: auto; } /* Reducido ligeramente para ganar espacio */
        .company-box { border: 1px solid #000; padding: 6px; font-size: 8.5px; }
        
        .title-box { border: 1px solid #000; padding: 5px; margin-bottom: 8px; background-color: #f8f9fa; }
        .title-text { font-weight: bold; font-size: 13px; color: #004D99; text-align: center; text-transform: uppercase; }
        
        .data-table td { border: 1px solid #000; padding: 3px 5px; }
        .bg-gray { background-color: #f0f0f0; font-weight: bold; width: 18%; }
        
        .items-table th { background-color: #004D99; color: #ffffff; border: 1px solid #000; text-align: center; font-weight: bold; font-size: 8px; padding: 4px; }
        .items-table td { border: 1px solid #000; padding: 4px; font-size: 8.5px; }
        
        .section-header { background-color: #e6f2ff; font-weight: bold; padding: 3px 5px; border: 1px solid #000; text-transform: uppercase; margin-top: 5px; font-size: 9px; }
        
        .signature-container { margin-top: 25px; }
        .signature-box { border: 1px solid #000; height: 80px; text-align: center; vertical-align: bottom; padding-bottom: 5px; }
        
        .page-number:after { content: counter(page); }
        .page-count:after { content: counter(pages); }
    </style>
</head>
<body>

    <div id="header_content">
        <div style="text-align: right; font-size: 7.5px; margin-bottom: 3px;">
            Código: VCF-LAB-FOR-022 | Fecha: 02/02/2023 | Versión: 01 | Página <span class="page-number"></span> de <span class="page-count"></span>
        </div>
        
        <table>
            <tr>
                <td style="width: 40%; text-align: center;">
                    <img src="{% static 'img/LogoF.png' %}" class="logo-img" alt="Logo">
                </td>
                <td style="width: 60%;">
                    <div class="company-box" style="text-align: left;">
                        <strong>Razón Social:</strong> Grupo Vicaf SAC<br>
                        <strong>RUC:</strong> 20609464632<br>
                        <strong>Dirección:</strong> JR. LOS TOPACIOS 440 - CAJAMARCA<br>
                        <strong>Email:</strong> informes@grupovicaf.com | <strong>Tel:</strong> 960 713 555
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <div id="footer_content">
        <div style="border-top: 1px solid #000; width: 100%; margin-bottom: 3px;"></div>
        JR. LOS TOPACIOS 440 - CAJAMARCA | informes@grupovicaf.com | +51 941 573 750<br>
        <strong>SISTEMA DE GESTIÓN DE LABORATORIO - VICAFPRO LAB</strong>
    </div>

    <div class="title-box">
        <div class="title-text">CARGO DE RECEPCIÓN DE MUESTRAS</div>
        <table style="width: 100%; border: none; margin: 0;">
            <tr>
                <td style="border: none; font-weight: bold; font-size: 9px;">REGISTRO No. {{ recepcion.id|stringformat:"05d" }}</td>
                <td style="border: none; text-align: right; font-weight: bold; font-size: 9px;">Fecha: {{ recepcion.fecha_recepcion|date:"d \d\e F \d\e Y" }}</td>
            </tr>
        </table>
    </div>

    <div class="section-header">1. Información General</div>
    <table class="data-table">
        <tr>
            <td class="bg-gray">CLIENTE:</td>
            <td colspan="3">{{ cliente.razon_social|default:cliente }}</td>
        </tr>
        <tr>
            <td class="bg-gray">PROYECTO:</td>
            <td>{{ proyecto.nombre_proyecto|default:"S/P" }}</td>
            <td class="bg-gray">CÓDIGO PROY:</td>
            <td>{{ proyecto.codigo_proyecto|default:"-" }}</td>
        </tr>
        <tr>
            <td class="bg-gray">PROCEDENCIA:</td>
            <td>{{ recepcion.procedencia|upper }}</td>
            <td class="bg-gray">HORA INGRESO:</td>
            <td>{{ recepcion.fecha_recepcion|date:"H:i" }} hrs</td>
        </tr>
    </table>

    <div class="section-header">2. Detalle de Muestras Recibidas</div>
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 5%;">ÍT.</th>
                <th style="width: 15%;">CÓD. LAB</th>
                <th style="width: 30%;">TIPO / DESCRIPCIÓN</th>
                <th style="width: 8%;">CANT.</th>
                <th style="width: 8%;">UND.</th>
                <th style="width: 10%;">MASA (kg)</th>
                <th style="width: 24%;">OBSERVACIONES</th>
            </tr>
        </thead>
        <tbody>
            {% for muestra in muestras %}
            <tr>
                <td class="text-center">{{ forloop.counter }}</td>
                <td class="text-center font-bold corporate-blue">{{ muestra.codigo_laboratorio }}</td>
                <td>
                    <strong>{{ muestra.tipo_muestra.nombre }}</strong><br>
                    <span style="font-size: 7.5px; color: #444;">{{ muestra.descripcion|default:"-" }}</span>
                </td>
                <td class="text-center">{{ muestra.cantidad }}</td>
                <td class="text-center">{{ muestra.unidad }}</td>
                <td class="text-center">{{ muestra.masa_aprox|default:"-" }}</td>
                <td style="font-size: 7.5px;">{{ muestra.observaciones|default:"-" }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center">No se registraron muestras.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="section-header">3. Conformidad de Recepción</div>
    <table class="signature-container" style="border: none;">
        <tr>
            <td style="width: 48%; border: none;">
                <div class="signature-box"></div>
                <div class="text-center font-bold" style="margin-top: 5px;">
                    {{ recepcion.responsable_cliente|default:"Firma del Cliente"|upper }}<br>
                    <span style="font-size: 7px; font-weight: normal;">ENTREGUÉ CONFORME (CLIENTE)</span>
                </div>
            </td>
            <td style="width: 4%; border: none;"></td>
            <td style="width: 48%; border: none;">
                <div class="signature-box"></div>
                <div class="text-center font-bold" style="margin-top: 5px;">
                    {{ user.get_full_name|default:user.username|upper }}<br>
                    <span style="font-size: 7px; font-weight: normal;">RECIBÍ CONFORME (VICAFPRO LAB)</span>
                </div>
            </td>
        </tr>
    </table>

    <div style="margin-top: 15px; font-size: 7.5px; color: #333;">
        <strong>Responsable de Registro en Sistema:</strong> {{ recepcion.responsable_recepcion.get_full_name }} | <strong>Impreso:</strong> {% now "d/m/Y H:i" %}
    </div>

</body>
</html>