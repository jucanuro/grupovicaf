{% load static %}

{% if proyectos_pendientes %}
<div class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full border-separate border-spacing-0" id="projects-table">
            <thead class="bg-slate-50">
                <tr>
                    <th class="py-3 px-6 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200">
                        Proyecto / Código
                    </th>
                    <th class="py-3 px-6 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200">
                        Cliente
                    </th>
                    <th class="py-3 px-6 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200 hidden sm:table-cell">
                        Monto
                    </th>
                    <th class="py-3 px-6 text-center text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200 hidden sm:table-cell">
                        N° Muestras
                    </th>
                    <th class="py-3 px-6 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200">
                        Estado
                    </th>
                    <th class="py-3 px-6 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest border-b border-slate-200">
                        Acciones
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
                {% for proyecto in proyectos_pendientes %}
                <tr class="group hover:bg-blue-50/50 transition-colors duration-200" 
                    data-id="{{ proyecto.pk }}"
                    data-nombre="{{ proyecto.nombre_proyecto }}" 
                    data-cliente="{{ proyecto.cliente.razon_social }}"
                    data-monto="{{ proyecto.monto_cotizacion }}" 
                    data-muestras="{{ proyecto.numero_muestras }}"
                    data-estado="{{ proyecto.estado }}">
                    
                    <td class="py-4 px-6 whitespace-nowrap text-sm font-medium text-gray-900">
                        <div class="flex flex-col">
                            <span class="text-[13px] font-bold text-slate-800 tracking-tight">{{ proyecto.nombre_proyecto }}</span>
                            <span class="text-[10px] font-mono text-blue-500 uppercase tracking-tighter">{{ proyecto.codigo_proyecto }}</span>
                        </div>
                    </td>
                    
                    <td class="py-4 px-6 whitespace-nowrap text-sm text-gray-600">
                        {{ proyecto.cliente.razon_social }}
                    </td>

                    <td class="py-4 px-6 whitespace-nowrap text-sm text-gray-600 hidden sm:table-cell font-mono">
                        S/. {{ proyecto.monto_cotizacion|floatformat:2 }} 
                    </td>

                    <td class="py-4 px-6 whitespace-nowrap text-sm text-gray-600 hidden sm:table-cell text-center font-bold font-mono">
                        {{ proyecto.numero_muestras }} 
                    </td>
                    
                    <td class="py-4 px-6 whitespace-nowrap text-sm">
                        <span class="px-3 py-1 inline-flex text-[10px] leading-5 font-black rounded-full border uppercase tracking-widest
                            {% if proyecto.estado == 'PENDIENTE' %}bg-gray-100 text-gray-700 border-gray-300{% endif %}
                            {% if proyecto.estado == 'EN_CURSO' %}bg-blue-100 text-blue-700 border-blue-300{% endif %}
                            {% if proyecto.estado == 'MUESTRAS_ASIGNADAS' %}bg-green-100 text-green-700 border-green-300{% endif %}
                            {% if proyecto.estado == 'MUESTRAS_VALIDADAS' %}bg-indigo-100 text-indigo-700 border-indigo-300{% endif %}
                            {% if proyecto.estado == 'FINALIZADO' %}bg-purple-100 text-purple-700 border-purple-300{% endif %}
                            {% if proyecto.estado == 'CANCELADO' %}bg-red-100 text-red-700 border-red-300{% endif %}
                        ">
                            {{ proyecto.get_estado_display }}
                        </span>
                    </td>
                    
                    <td class="py-4 px-6 whitespace-nowrap text-left text-sm font-medium">
                        <a href="{% url 'proyectos:registrar_recepcion_lote' proyecto.id %}"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-full
                                    text-xs font-bold text-white
                                    bg-gradient-to-r from-emerald-500 to-green-600
                                    hover:from-emerald-600 hover:to-green-700
                                    transition duration-300 ease-in-out
                                    shadow-md hover:shadow-lg
                                    transform hover:scale-[1.03]"
                            aria-label="Ir a la Gestión de Muestras">
                            <i data-lucide="flask-round" class="w-4 h-4 fill-white"></i> 
                            Gestión
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <footer class="py-3 px-6 bg-slate-50 border-t border-slate-200 flex justify-between items-center">
        <span class="text-[9px] font-mono text-slate-400 uppercase tracking-widest">Total: {{ proyectos_pendientes.paginator.count|default:0 }} items</span>
        
        {% if proyectos_pendientes.has_other_pages %}
        <div class="flex items-center gap-2">
            {% if proyectos_pendientes.has_previous %}
            <a href="?page={{ proyectos_pendientes.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
                class="px-3 py-1 text-gray-700 bg-white border border-slate-300 rounded hover:bg-gray-50 text-[10px] font-bold uppercase transition-all">Anterior</a>
            {% endif %}

            <span class="px-3 py-1 text-[10px] text-gray-800 bg-gray-100 rounded border border-slate-300 font-bold uppercase">
                Pág {{ proyectos_pendientes.number }} de {{ proyectos_pendientes.paginator.num_pages }}
            </span>

            {% if proyectos_pendientes.has_next %}
            <a href="?page={{ proyectos_pendientes.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
                class="px-3 py-1 text-gray-700 bg-white border border-slate-300 rounded hover:bg-gray-50 text-[10px] font-bold uppercase transition-all">Siguiente</a>
            {% endif %}
        </div>
        {% endif %}
    </footer>
</div>

{% else %}
<div class="bg-white border border-slate-200 border-dashed rounded-xl p-16 text-center">
    <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-slate-100">
        <i data-lucide="search-x" class="w-8 h-8 text-slate-300"></i>
    </div>
    <p class="text-[11px] font-bold text-slate-400 uppercase tracking-[0.3em]">No hay proyectos pendientes</p>
</div>
{% endif %}

<script>
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
</script>