{% extends 'base_vicafpro.html' %}

{% block content %}
<style>
    /* ---------------------------------- */
    /* ESTILOS GLOBALES Y CONTENEDOR */
    /* ---------------------------------- */

    .animated-gradient-text {
        background: linear-gradient(to right, #10B981, #3B82F6, #8B5CF6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        background-size: 200% auto;
        animation: text-gradient 3s linear infinite alternate;
    }

    @keyframes text-gradient {
        to {
            background-position: 200% center;
        }
    }
    .container {
        width: 95%; 
        max-width: 1200px;
        margin: 20px auto;
        padding: 0;
    }

    /* Tarjeta Principal (Adaptado a tema claro) */
    .card-light {
        background-color: #ffffff; /* Fondo claro (Blanco) */
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Sombra más suave */
        padding: 20px;
        color: #1f2937; /* Texto oscuro */
        border: 1px solid #e5e7eb; /* Borde sutil */
    }

    h1 {
        font-size: 1.8rem;
        color: #1f2937; /* Texto oscuro */
        margin-bottom: 5px;
        font-weight: 700;
        border-left: 4px solid #3b82f6; 
        padding-left: 10px;
    }

    .title-header {
        color: #6b7280; /* Gris medio */
        font-size: 1.2rem;
        margin-bottom: 10px;
        font-weight: 500;
    }

    /* ---------------------------------- */
    /* ESTILOS DE LA TABLA */
    /* ---------------------------------- */
    .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .data-table th, .data-table td {
        padding: 15px 20px;
        text-align: left;
        border: none;
    }

    /* Encabezado de la tabla (Claro) */
    .data-table thead th {
        background-color: #f9fafb; /* Fondo muy claro */
        color: #4b5563; /* Texto gris oscuro */
        font-weight: 600;
        font-size: 0.9rem;
        border-bottom: 1px solid #d1d5db; /* Separador de borde claro */
    }
    
    /* Filas del cuerpo */
    .data-table tbody tr {
        border-bottom: 1px solid #f3f4f6; /* Separador de filas muy claro */
        background-color: #ffffff; /* Fondo de fila blanco */
        transition: background-color 0.2s;
    }

    .data-table tbody tr:hover {
        background-color: #f9fafb; /* Efecto hover sutil */
    }
    
    /* ESTADOS */
    /* Se mantiene la estructura de colores de estado (verde) pero adaptada al fondo blanco */
    .status-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: capitalize;
        background-color: #d1fae5; /* Fondo verde claro */
        color: #059669; /* Texto verde oscuro */
    }

    /* ---------------------------------- */
    /* BOTONES Y ACCIONES */
    /* ---------------------------------- */
    .action-group {
        display: flex;
        gap: 8px;
    }

    .btn-action-view {
        background-color: #3b82f6; /* Azul primario */
        color: white;
        padding: 8px 12px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 500;
        transition: background-color 0.2s;
        white-space: nowrap;
    }
    .btn-action-view:hover {
        background-color: #2563eb;
    }
    
    .btn-disabled {
        background-color: #e5e7eb; /* Gris claro para deshabilitado */
        color: #9ca3af; /* Texto gris */
        padding: 8px 12px;
        border-radius: 5px;
        font-weight: 500;
        cursor: not-allowed;
        display: inline-block;
        white-space: nowrap;
    }

</style>
 <div class="border-b border-gray-200 pb-4 mb-6">
    <header class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6 animate-fade-in-up">
        <h1 class="flex text-xl font-extrabold animated-gradient-text"> 
            Lista de solicitudes de ensayo
            <svg class="h-6 w-6 ml-4 fill-sky-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M184.6 475.5C181.5 482.8 179.2 490.4 177.8 498.1C163.3 506.9 146.3 512 128 512C75 512 32 469 32 416L32 128C14.3 128 0 113.7 0 96C0 78.3 14.3 64 32 64L224 64C241.7 64 256 78.3 256 96C256 113.7 241.7 128 224 128L224 383.6L184.6 475.5zM96 128L96 256L160 256L160 128L96 128zM352 64L512 64C529.7 64 544 78.3 544 96C544 113.7 529.7 128 512 128L512 281.4L603.3 494.4C605.6 499.8 607.1 505.5 607.7 511.4L608 512L607.7 512C607.9 513.8 608 515.6 608 517.4C608 549.7 581.8 576 549.4 576L282.5 576C250.2 576 223.9 549.8 223.9 517.4C223.9 515.6 224 513.8 224.2 512L223.9 512L224.2 511.4C224.8 505.6 226.3 499.8 228.6 494.4L320 281.4L320 128C302.3 128 288 113.7 288 96C288 78.3 302.3 64 320 64L352 64zM453.2 306.6C449.8 298.6 448 290.1 448 281.4L448 128L384 128L384 281.4C384 290.1 382.2 298.6 378.8 306.6L345.6 384L486.3 384L453.1 306.6z"/></svg>
        </h1>
        <a href="{% url 'proyectos:lista_proyectos_pendientes' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-white text-gray-700 font-semibold rounded-lg hover:bg-gray-50 transition-all duration-300 border border-gray-300 shadow-sm flex-shrink-0">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="list" class="lucide lucide-list w-5 h-5"><path d="M3 5h.01"></path><path d="M3 12h.01"></path><path d="M3 19h.01"></path><path d="M8 5h13"></path><path d="M8 12h13"></path><path d="M8 19h13"></path></svg>
            Regresar a Lista
        </a>
    </header>
 </div>
<div class="mt-6 w-full rounded-lg">
    
    {# Contenedor principal adaptado a color blanco #}
    <div class="bg-white shadow-xl rounded-lg text-gray-800 border border-gray-200">
        
        <div class="overflow-x-auto rounded-lg">
            {# Borde y texto de la tabla adaptados #}
            <table class="w-full text-sm text-left text-gray-700 border-separate border border-gray-200 rounded-lg">
                
                {# Encabezado de la tabla adaptado #}
                <thead class="text-xs uppercase bg-gray-50 text-gray-600">
                    <tr>
                        <th scope="col" class="py-3 px-6 rounded-tl-lg font-semibold tracking-wider">Código Solicitud</th>
                        <th scope="col" class="py-3 px-6 font-semibold tracking-wider">Estado</th>
                        <th scope="col" class="py-3 px-6 font-semibold tracking-wider">Fecha Creación</th> 
                        <th scope="col" class="py-3 px-6 font-semibold tracking-wider">Generada Por</th>
                        <th scope="col" class="py-3 px-6 rounded-tr-lg text-center font-semibold tracking-wider">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for solicitud in solicitudes %}
                        {# Fondo de fila adaptado, hover sutil #}
                        <tr class="bg-white border-b border-gray-200 hover:bg-gray-50 transition duration-150 ease-in-out">
                            <td class="py-4 px-6 font-medium text-gray-900">{{ solicitud.codigo_solicitud }}</td>
                            
                            <td class="py-4 px-6">
                                {# El badge de estado original usa verde oscuro en verde claro, que funciona bien en fondo blanco. #}
                                <span class="px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-700">
                                    {{ solicitud.estado|default:"Pendiente" }}
                                </span>
                            </td>
                            
                            <td class="py-4 px-6 text-gray-600">{{ solicitud.creado_en|date:"Y-m-d H:i" }}</td>
                            
                            <td class="py-4 px-6 text-gray-700">{{ solicitud.generada_por.nombre_completo|default:"N/A" }}</td>
                            
                            <td class="py-4 px-6">
                                <div class="flex justify-center space-x-2">
                                    {% comment %} 
                                        Corrección NoReverseMatch: Solo muestra el enlace de edición si tiene una Muestra.
                                        Se mantiene el nombre 'btn-action-view' y 'btn-disabled' con clases Tailwind.
                                    {% endcomment %}
                                    {% if solicitud.muestra and solicitud.muestra.pk %}
                                        <div class="flex justify-center space-x-2">
                                            
                                            {% if solicitud.muestra and solicitud.muestra.pk %}
                                                
                                                {# Botón Editar: Adaptado para fondo blanco #}
                                                <a href="{% url 'proyectos:gestion_solicitud_ensayo_editar' solicitud.muestra.pk solicitud.pk %}" 
                                                class="flex items-center space-x-1 text-sm font-medium text-blue-600 hover:text-white bg-blue-100 hover:bg-blue-600 px-3 py-1 rounded transition duration-150 whitespace-nowrap">
                                                    <i data-lucide="edit" class="w-4 h-4 mr-1"></i>
                                                    <span>Editar</span>
                                                </a>

                                                {# Botón PDF: Adaptado para fondo blanco #}
                                                <a href="{% url 'proyectos:ver_pdf_solicitud_ensayo' solicitud.pk %}" 
                                                    target="_blank" 
                                                    class="flex items-center space-x-1 text-sm font-medium text-red-600 hover:text-white bg-red-100 hover:bg-red-600 px-3 py-1 rounded transition duration-150 whitespace-nowrap">
                                                    <i data-lucide="file-text" class="w-4 h-4 mr-1"></i>
                                                    <span>Generar PDF</span>
                                                </a>

                                            {% else %}
                                                {# Estado Deshabilitado: Adaptado para fondo blanco #}
                                                <span class="text-sm font-medium text-gray-500 bg-gray-200 px-3 py-1 rounded cursor-not-allowed whitespace-nowrap">
                                                    Detalles no disponibles
                                                </span>
                                            {% endif %}
                                        </div>
                                    {% else %}
                                        {# Estado Deshabilitado: Adaptado para fondo blanco #}
                                        <span class="text-sm font-medium text-gray-500 bg-gray-200 px-3 py-1 rounded cursor-not-allowed whitespace-nowrap">
                                            Detalles
                                        </span>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="5" class="py-4 px-6 text-center text-gray-500 bg-gray-50">
                                No hay solicitudes registradas.
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
    </div>
</div>
{% endblock content %}