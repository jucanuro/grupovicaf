{% extends "base_vicafpro.html" %}
{% load static %}

{% block content %}
<style>
    /* Fondo Geométrico Abstracto Normalizado */
    .bg-geometric {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-color: #ffffff;
        overflow: hidden;
    }

    .shape-rhombus {
        position: absolute;
        width: 150px;
        height: 150px;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(37, 99, 235, 0.02) 100%);
        transform: rotate(45deg);
        border-radius: 20px;
        top: 10%;
        left: -50px;
        animation: float 6s ease-in-out infinite;
    }

    .shape-cylinder {
        position: absolute;
        width: 60px;
        height: 200px;
        background: linear-gradient(to bottom, rgba(16, 185, 129, 0.05), transparent);
        border-radius: 100px;
        bottom: 5%;
        right: 15%;
        transform: rotate(-20deg);
        animation: float 8s ease-in-out infinite reverse;
    }

    .shape-pyramid {
        position: absolute;
        width: 0;
        height: 0;
        border-left: 100px solid transparent;
        border-right: 100px solid transparent;
        border-bottom: 170px solid rgba(139, 92, 246, 0.04);
        top: 40%;
        right: -50px;
        transform: rotate(15deg);
    }

    @keyframes float {
        0% { transform: translateY(0px) rotate(45deg); }
        50% { transform: translateY(-20px) rotate(48deg); }
        100% { transform: translateY(0px) rotate(45deg); }
    }

    .animated-gradient-text {
        background: linear-gradient(to right, #10B981, #3B82F6, #8B5CF6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% auto;
        animation: text-gradient 3s linear infinite alternate;
    }

    @keyframes text-gradient { to { background-position: 200% center; } }

    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.7);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.04);
    }
</style>

<div class="bg-geometric">
    <div class="shape-rhombus"></div>
    <div class="shape-cylinder"></div>
    <div class="shape-pyramid"></div>
    <div class="shape-rhombus" style="top: 70%; left: 80%; width: 80px; height: 80px; opacity: 0.5;"></div>
</div>

<div class="space-y-6 relative z-10">
    <div class="pb-8 mb-4">
        <header class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 animate-fade-in-up">
            <div class="relative pl-4 border-l-4 border-emerald-500">
                <h1 class="text-xl font-black tracking-tighter animated-gradient-text uppercase">
                    Equipo Técnico
                </h1>
                <p class="text-slate-500 text-xs font-bold mt-1 uppercase tracking-[0.2em] flex items-center gap-2">
                    <span class="w-8 h-[1px] bg-slate-300"></span>
                    Administración de Personal
                </p>
            </div>
            
            <div class="flex flex-col sm:flex-row items-center gap-4 w-full lg:w-auto">
                <div class="relative w-full sm:w-80 group">
                    <div class="absolute inset-0 bg-slate-100 translate-y-1 translate-x-1 -z-10" 
                        style="clip-path: polygon(5% 0, 100% 0, 95% 100%, 0 100%);"></div>
                    <div class="relative bg-white border border-slate-300 transition-all focus-within:ring-2 focus-within:ring-blue-600" 
                        style="clip-path: polygon(4% 0%, 100% 0%, 96% 100%, 0% 100%);">
                        <i data-lucide="search" class="absolute left-6 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                        <input type="text" id="searchInput" placeholder="BUSCAR TRABAJADOR..." 
                            class="w-full pl-12 pr-8 py-3 bg-transparent border-none text-[13px] font-black tracking-widest text-slate-700 placeholder-slate-300 focus:ring-0 outline-none">
                    </div>
                </div>

                <a href="{% url 'trabajadores:crear_trabajador' %}" 
                class="relative inline-flex items-center gap-3 px-8 py-3 bg-slate-900 text-white transition-all duration-300 hover:bg-emerald-600 hover:-translate-y-1 group w-full sm:w-auto justify-center"
                style="clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%);">
                    <i data-lucide="user-plus" class="w-4 h-4 group-hover:rotate-12 transition-transform"></i>
                    <span class="text-xs font-black uppercase tracking-[0.2em]">Nuevo Registro</span>
                </a>
            </div>
        </header>
    </div>

    <div class="relative animate-fade-in-up group/container">
        <div class="absolute inset-0 bg-slate-200/60 translate-y-3 translate-x-1 -z-10" 
            style="clip-path: polygon(0 0, 100% 0, 98% 100%, 2% 100%);"></div>

        <div class="glass-card p-1 overflow-hidden shadow-2xl" 
            style="clip-path: polygon(0 0, 100% 0, 98% 100%, 2% 100%); border-radius: 4px;">
            
            <div class="bg-white/95 backdrop-blur-2xl p-4 md:p-10">
                {% if trabajadores %}
                <div class="overflow-x-auto">
                    <table class="min-w-full text-left border-separate border-spacing-y-3">
                        <thead>
                            <tr class="text-slate-400">
                                <th class="py-4 px-6 font-black text-[10px] uppercase tracking-[0.25em] border-b border-slate-100">Colaborador</th>
                                <th class="py-4 px-6 font-black text-[10px] uppercase tracking-[0.25em] border-b border-slate-100">Usuario ID</th>
                                <th class="py-4 px-6 font-black text-[10px] uppercase tracking-[0.25em] border-b border-slate-100 hidden md:table-cell">Rol Asignado</th>
                                <th class="py-4 px-6 font-black text-[10px] uppercase tracking-[0.25em] border-b border-slate-100 text-right">Acciones</th>
                            </tr>
                        </thead>
                        
                        <tbody id="trabajadores-table-body">
                            {% for trabajador in trabajadores %}
                            <tr class="group bg-white hover:bg-slate-50/80 transition-all duration-500 shadow-sm border border-slate-100">
                                <td class="py-5 px-6 border-y border-l border-slate-50">
                                    <div class="flex items-center gap-5">
                                        <div class="relative">
                                            <div class="w-12 h-12 bg-slate-800 flex items-center justify-center text-white font-bold text-sm transition-all duration-300 group-hover:bg-emerald-600 group-hover:-translate-y-1" 
                                                style="clip-path: polygon(20% 0, 100% 0, 80% 100%, 0 100%);">
                                                {{ trabajador.nombre_completo|slice:":1" }}
                                            </div>
                                            <div class="absolute inset-0 bg-emerald-100 -z-10 translate-y-1 translate-x-1"
                                                style="clip-path: polygon(20% 0, 100% 0, 80% 100%, 0 100%);"></div>
                                        </div>
                                        <div>
                                            <p class="font-bold text-slate-800 text-sm tracking-tight leading-none group-hover:text-emerald-600 transition-colors">
                                                {{ trabajador.nombre_completo }}
                                            </p>
                                            <p class="text-[9px] text-slate-400 mt-2 uppercase font-black tracking-widest italic">{{ trabajador.user.email }}</p>
                                        </div>
                                    </div>
                                </td>

                                <td class="py-5 px-6 border-y border-slate-50">
                                    <span class="px-3 py-1.5 bg-slate-100 text-blue-600 font-mono text-[11px] font-bold border-l-2 border-blue-500 uppercase">
                                        {{ trabajador.user.username }}
                                    </span>
                                </td>

                                <td class="py-5 px-6 border-y border-slate-50 hidden md:table-cell">
                                    <span class="text-[10px] bg-slate-800 text-white px-3 py-1 font-black uppercase tracking-tighter" style="clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);">
                                        {{ trabajador.get_role_display }}
                                    </span>
                                </td>

                                <td class="py-5 px-6 border-y border-r border-slate-50 text-right">
                                    <div class="flex justify-end gap-3 opacity-0 group-hover:opacity-100 transition-all transform translate-x-4 group-hover:translate-x-0">
                                        <a href="{% url 'trabajadores:editar_trabajador' pk=trabajador.pk %}" 
                                           class="w-10 h-10 bg-slate-100 flex items-center justify-center text-slate-500 hover:text-white hover:bg-blue-600 transition-all"
                                           style="clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%);">
                                            <i data-lucide="edit-3" class="w-4 h-4"></i>
                                        </a>
                                        <a href="{% url 'trabajadores:eliminar_trabajador' pk=trabajador.pk %}" 
                                           class="w-10 h-10 bg-slate-100 flex items-center justify-center text-slate-500 hover:text-white hover:bg-rose-600 transition-all"
                                           style="clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%);">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div id="pagination-controls" class="flex justify-between items-center mt-12 pt-6 border-t border-slate-100 px-2">
                    <div class="hidden sm:block">
                        <p class="text-[10px] font-black text-slate-300 uppercase tracking-[0.3em]">VICAF PRO / STAFF MANAGEMENT</p>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <span class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Página {{ trabajadores.number }} de {{ trabajadores.paginator.num_pages }}</span>
                        <div class="flex items-center gap-1">
                            {% if trabajadores.has_previous %}
                            <a href="?page={{ trabajadores.previous_page_number }}" class="w-10 h-10 flex items-center justify-center bg-slate-50 text-slate-400 hover:bg-slate-900 hover:text-white transition-all" style="clip-path: polygon(20% 0, 100% 0, 80% 100%, 0 100%);">
                                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            </a>
                            {% endif %}
                            
                            <div class="h-1.5 w-24 bg-slate-100 rounded-full overflow-hidden mx-2">
                                <div class="h-full bg-gradient-to-r from-emerald-500 to-blue-600" 
                                    style="width: {% widthratio trabajadores.number trabajadores.paginator.num_pages 100 %}%"></div>
                            </div>

                            {% if trabajadores.has_next %}
                            <a href="?page={{ trabajadores.next_page_number }}" class="w-10 h-10 flex items-center justify-center bg-slate-50 text-slate-400 hover:bg-slate-900 hover:text-white transition-all" style="clip-path: polygon(20% 0, 100% 0, 80% 100%, 0 100%);">
                                <i data-lucide="chevron-right" class="w-4 h-4"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <div id="no-results-message" class="hidden p-20 text-center">
                    <i data-lucide="user-x" class="w-16 h-16 mx-auto text-slate-200 mb-4"></i>
                    <p class="text-xs font-black text-slate-400 uppercase tracking-widest">No se encontraron colaboradores</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof lucide !== 'undefined') lucide.createIcons();

        const searchInput = document.getElementById('searchInput');
        const tableBody = document.getElementById('trabajadores-table-body');
        const pagination = document.getElementById('pagination-controls');
        const noResults = document.getElementById('no-results-message');

        searchInput.addEventListener('keyup', async (e) => {
            const query = e.target.value.trim();
            if (query.length > 2) {
                const url = `{% url 'trabajadores:buscar_trabajadores_api' %}?q=${query}`;
                const response = await fetch(url);
                const data = await response.json();
                
                tableBody.innerHTML = '';
                if(pagination) pagination.classList.add('hidden');

                if (data.length === 0) {
                    noResults.classList.remove('hidden');
                    tableBody.closest('.overflow-x-auto').classList.add('hidden');
                } else {
                    noResults.classList.add('hidden');
                    tableBody.closest('.overflow-x-auto').classList.remove('hidden');
                    
                    data.forEach(t => {
                        tableBody.innerHTML += `
                        <tr class="group bg-white hover:bg-slate-50 transition-all shadow-sm">
                            <td class="py-5 px-6 border-y border-l border-slate-50">
                                <div class="flex items-center gap-5">
                                    <div class="w-12 h-12 bg-slate-800 flex items-center justify-center text-white font-bold" style="clip-path: polygon(20% 0, 100% 0, 80% 100%, 0 100%);">${t.nombre_completo.charAt(0)}</div>
                                    <div><p class="font-bold text-slate-800 text-sm">${t.nombre_completo}</p></div>
                                </div>
                            </td>
                            <td class="py-5 px-6 border-y border-slate-50"><span class="px-3 py-1.5 bg-slate-100 text-blue-600 font-mono text-[11px] font-bold uppercase">${t.username}</span></td>
                            <td class="py-5 px-6 border-y border-slate-50 hidden md:table-cell"><span class="text-[10px] bg-slate-800 text-white px-3 py-1 font-black uppercase tracking-tighter" style="clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);">${t.role}</span></td>
                            <td class="py-5 px-6 border-y border-r border-slate-50 text-right">
                                <div class="flex justify-end gap-3"><a href="/trabajadores/editar/${t.pk}/" class="w-10 h-10 bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-blue-600 hover:text-white transition-all" style="clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%);"><i data-lucide="edit-3" class="w-4 h-4"></i></a></div>
                            </td>
                        </tr>`;
                    });
                    lucide.createIcons();
                }
            } else if (query.length === 0) {
                window.location.reload();
            }
        });
    });
</script>
{% endblock %}