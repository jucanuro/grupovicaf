{% extends "base_vicafpro.html" %}
{% load static %}

{% block content %}
<style>
    /* Fondo Geométrico Estándar VicafPro */
    .bg-geometric {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-color: #ffffff;
        overflow: hidden;
    }

    .shape-rhombus {
        position: absolute;
        width: 150px;
        height: 150px;
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(37, 99, 235, 0.02) 100%);
        transform: rotate(45deg);
        border-radius: 20px;
        top: 10%;
        left: -50px;
        animation: float 6s ease-in-out infinite;
    }

    .shape-cylinder {
        position: absolute;
        width: 60px;
        height: 200px;
        background: linear-gradient(to bottom, rgba(16, 185, 129, 0.05), transparent);
        border-radius: 100px;
        bottom: 5%;
        right: 15%;
        transform: rotate(-20deg);
        animation: float 8s ease-in-out infinite reverse;
    }

    @keyframes float {
        0% { transform: translateY(0px) rotate(45deg); }
        50% { transform: translateY(-20px) rotate(48deg); }
        100% { transform: translateY(0px) rotate(45deg); }
    }

    .animated-gradient-text {
        background: linear-gradient(to right, #10B981, #3B82F6, #8B5CF6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% auto;
        animation: text-gradient 3s linear infinite alternate;
    }

    @keyframes text-gradient { to { background-position: 200% center; } }

    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.7);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.04);
    }

    .input-trapezoid {
        clip-path: polygon(2% 0%, 100% 0%, 98% 100%, 0% 100%);
    }
</style>

<div class="bg-geometric">
    <div class="shape-rhombus"></div>
    <div class="shape-cylinder"></div>
</div>

<div class="space-y-6 relative z-10">
    <div class="pb-8 mb-4">
        <header class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6 animate-fade-in-up">
            <div class="relative pl-4 border-l-4 border-blue-600">
                <h1 class="text-xl font-black tracking-tighter animated-gradient-text uppercase">
                    {% if trabajador %}Edición de Perfil{% else %}Registro de Colaborador{% endif %}
                </h1>
                <p class="text-slate-500 text-xs font-bold mt-1 uppercase tracking-[0.2em] flex items-center gap-2">
                    <span class="w-8 h-[1px] bg-slate-300"></span>
                    Módulo de Recursos Humanos
                </p>
            </div>
            
            <a href="{% url 'trabajadores:lista_trabajadores' %}" 
               class="relative inline-flex items-center gap-3 px-8 py-3 bg-slate-900 text-white transition-all duration-300 hover:bg-slate-700 hover:-translate-y-1 group"
               style="clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%);">
                <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i>
                <span class="text-xs font-black uppercase tracking-[0.2em]">Volver al Listado</span>
            </a>
        </header>
    </div>

    <div class="relative animate-fade-in-up">
        <div class="absolute inset-0 bg-slate-200/60 translate-y-3 translate-x-1 -z-10" 
            style="clip-path: polygon(0 0, 100% 0, 99% 100%, 1% 100%);"></div>

        <div class="glass-card p-1 shadow-2xl" 
            style="clip-path: polygon(0 0, 100% 0, 99% 100%, 1% 100%); border-radius: 4px;">
            
            <div class="bg-white/95 backdrop-blur-2xl p-6 md:p-12">
                {% if error %}
                <div class="mb-8 p-4 bg-rose-50 border-l-4 border-rose-500 text-rose-700 text-xs font-black uppercase tracking-widest flex items-center gap-3">
                    <i data-lucide="alert-circle" class="w-5 h-5"></i>
                    {{ error }}
                </div>
                {% endif %}

                <form method="post" class="space-y-2">
                    {% csrf_token %}
                    
                    <div class="relative">
                        <div class="flex items-center gap-4 mb-8">
                            <span class="text-3xl font-black text-slate-100 italic">01</span>
                            <h2 class="text-sm font-black text-slate-800 uppercase tracking-[0.3em]">Credenciales de Acceso</h2>
                            <div class="h-[1px] flex-1 bg-slate-100"></div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Usuario Login</label>
                                <div class="relative">
                                    <input type="text" name="username" value="{% if trabajador %}{{ trabajador.user.username }}{% else %}{{ user_username|default:'' }}{% endif %}"
                                        class="w-full px-6 py-4 bg-slate-50 border-none text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 transition-all input-trapezoid" required>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Email Corporativo</label>
                                <input type="email" name="email" value="{% if trabajador %}{{ trabajador.user.email }}{% else %}{{ user_email|default:'' }}{% endif %}"
                                    class="w-full px-6 py-4 bg-slate-50 border-none text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 transition-all input-trapezoid" required>
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">
                                    {% if trabajador %}Cambiar Contraseña{% else %}Contraseña Inicial{% endif %}
                                </label>
                                <input type="password" {% if trabajador %}name="new_password"{% else %}name="password" required{% endif %}
                                    class="w-full px-6 py-4 bg-slate-50 border-none text-sm font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 transition-all input-trapezoid"
                                    placeholder="••••••••">
                            </div>
                        </div>
                    </div>

                    <div class="relative">
                        <div class="flex items-center gap-4 mb-8">
                            <span class="text-3xl font-black text-slate-100 italic">02</span>
                            <h2 class="text-sm font-black text-slate-800 uppercase tracking-[0.3em]">Perfil del Colaborador</h2>
                            <div class="h-[1px] flex-1 bg-slate-100"></div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <div class="space-y-2 lg:col-span-1">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Nombres y Apellidos</label>
                                <input type="text" name="nombre_completo" value="{{ trabajador.nombre_completo|default:'' }}"
                                    class="w-full px-6 py-4 bg-slate-50 border-none text-sm font-bold text-slate-700 focus:ring-2 focus:ring-emerald-500 transition-all input-trapezoid" required>
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Título/Grado</label>
                                <input type="text" name="titulo_profesional" value="{{ trabajador.titulo_profesional|default:'' }}" placeholder="Ej. Ing. Civil"
                                    class="w-full px-6 py-4 bg-slate-50 border-none text-sm font-bold text-slate-700 focus:ring-2 focus:ring-emerald-500 transition-all input-trapezoid">
                            </div>

                            <div class="space-y-2">
                                <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-2">Cargo / Rol</label>
                                <div class="relative">
                                    <select name="role" class="w-full px-6 py-4 bg-slate-100 border-none text-sm font-bold text-slate-700 focus:ring-2 focus:ring-emerald-500 transition-all input-trapezoid appearance-none cursor-pointer" required>
                                        <option value="ADMIN" {% if trabajador.role == 'ADMIN' %}selected{% endif %}>Administrador</option>
                                        <option value="JEFE_LAB" {% if trabajador.role == 'JEFE_LAB' %}selected{% endif %}>Jefe de Laboratorio</option>
                                        <option value="SUPERVISOR" {% if trabajador.role == 'SUPERVISOR' %}selected{% endif %}>Supervisor</option>
                                        <option value="TECNICO" {% if trabajador.role == 'TECNICO' %}selected{% endif %}>Técnico / Ejecutor</option>
                                        <option value="COMERCIAL" {% if trabajador.role == 'COMERCIAL' %}selected{% endif %}>Gerente Comercial</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-6 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row justify-end items-center gap-6 pt-8 border-t border-slate-50">
                        <p class="text-[10px] font-black text-slate-300 uppercase tracking-[0.3em] mr-auto">Confirmación de Datos v2.0</p>
                        
                        <button type="submit" 
                            class="relative inline-flex items-center gap-4 px-12 py-4 bg-blue-600 text-white transition-all duration-300 hover:bg-emerald-600 hover:-translate-y-1 shadow-xl group w-full sm:w-auto justify-center"
                            style="clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);">
                            <i data-lucide="save" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                            <span class="text-xs font-black uppercase tracking-[0.2em]">
                                {% if trabajador %}Actualizar Perfil{% else %}Finalizar Registro{% endif %}
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        if (typeof lucide !== 'undefined') lucide.createIcons();
    });
</script>
{% endblock %}